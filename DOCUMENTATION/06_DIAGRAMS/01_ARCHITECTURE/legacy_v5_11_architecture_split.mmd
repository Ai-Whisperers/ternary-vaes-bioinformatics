%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#ff5252', 'edgeLabelBackground':'#f9f9f9', 'tertiaryColor': '#e1e4e8', 'mainBkg': '#fff3e0'}}}%%
graph TD
    subgraph Active [Active: V5.11 Production]
        direction TB
        style Active fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
        TrainScript[scripts/train/train.py]:::active
        Model11[src.models.TernaryVAEV5_11]:::active
        Loss11[src.losses.PAdicGeodesicLoss]:::active
        Gen[src.data.generation]:::active
        
        TrainScript --> Model11
        TrainScript --> Loss11
        TrainScript --> Gen
    end

    subgraph Legacy [Legacy: V5.6-V5.10]
        direction TB
        style Legacy fill:#ffebee,stroke:#c62828,stroke-width:2px
        LegacyTrainer[src.training.TernaryVAETrainer]:::legacy
        LegacyLoss[src.losses.DualVAELoss]:::legacy
        LegacyModel[src.models.archive.*]:::legacy
        
        LegacyTrainer --> LegacyLoss
        LegacyTrainer --> LegacyModel
    end

    subgraph Shared [Shared / Compat Layer]
        direction TB
        style Shared fill:#e3f2fd,stroke:#1565c0,stroke-dasharray: 5 5
        Init[src/__init__.py]
        LossInit[src/losses/__init__.py]
    end

    Shared -.-> Active
    Shared -.-> Legacy

    classDef active fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px;
    classDef legacy fill:#ffcdd2,stroke:#c62828,stroke-width:2px;

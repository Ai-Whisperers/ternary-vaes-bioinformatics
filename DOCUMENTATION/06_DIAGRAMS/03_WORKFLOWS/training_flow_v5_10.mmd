%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#2196f3', 'edgeLabelBackground':'#f9f9f9', 'tertiaryColor': '#e1e4e8'}}}%%
sequenceDiagram
    participant Script as train_ternary_v5_10.py
    participant Trainer as HyperbolicVAETrainer
    participant Monitor as TrainingMonitor
    participant TB as TensorBoard
    participant Console

    Script->>Trainer: train_epoch(loader)
    activate Trainer
    
    loop Every Batch
        Trainer->>Trainer: Compute Losses (Recon, KL, Rank)
    end

    Trainer->>Trainer: update_monitor_state(losses)
    
    Trainer->>Monitor: log_epoch(epoch, losses)
    activate Monitor
    
    par Logging Streams
        Monitor->>Console: log_epoch_summary()
        Monitor->>TB: log_hyperbolic_epoch() (Hyp Metrics)
        Monitor->>TB: _log_standard_tensorboard() (VAE Metrics)
    end
    
    opt Every Histogram Interval
        Monitor->>TB: log_histograms()
    end
    
    deactivate Monitor
    deactivate Trainer
